<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYC Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        padding: 20px;
    }
    .container-flex {
        display: flex;          /* side by side */
        flex-wrap: wrap;
        gap: 20px;
    }
    .aadhaar-section,
    .pan-section {
        width: 50%;             /* fixed width 50% each */
        box-sizing: border-box; /* include padding/border in width */
    }
    .section {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 20px;
        margin: 0;             /* remove extra margin, spacing handled by gap */
        flex: 1;
        display: flex;
        flex-direction: column; /* stack content vertically */
    }
    .json-output {
        margin-top: 15px;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        font-family: monospace;
        width: 100%;           /* fill parent width */
    }

    @media screen and (max-width: 768px) {
        .aadhaar-section,
        .pan-section {
            width: 100%;         /* stack vertically on smaller screens */
        }
    }
</style>

</head>


<body>
    <h2>KYC Verification Home</h2>
    <div class="container-flex">
    <!-- Aadhaar Section -->
    <div class="section aadhaar-section">
        <h4>Aadhaar Card</h4>
        <input type="file" id="aadhaarFile" class="form-control mb-2">
        <button class="btn btn-primary mb-2" onclick="uploadAadhaar()">Upload</button>
        <div id="aadhaarUploadOutput" class="json-output"></div>

        <button class="btn btn-success mt-3" onclick="saveAadhaar()">Save</button>
        <div id="aadhaarSaveOutput" class="json-output"></div>
    </div>

    <!-- PAN Section -->
    <div class="section pan-section">
        <h4>PAN Card</h4>
        <input type="file" id="panFile" class="form-control mb-2">
        <button class="btn btn-primary mb-2" onclick="uploadPAN()">Upload</button>
        <div id="panUploadOutput" class="json-output"></div>

        <button class="btn btn-success mt-3" onclick="savePAN()">Save</button>
        <div id="panSaveOutput" class="json-output"></div>
    </div>
</div>


    <script>
        let aadhaarData = null; // store extracted Aadhaar JSON
        let panData = null; // store extracted PAN JSON
        let jwtToken = null; // store JWT after saving Aadhaar

        // ---------- Aadhaar Functions ----------
        async function uploadAadhaar() {
            const fileInput = document.getElementById('aadhaarFile');
            if (fileInput.files.length === 0) return alert("Please select a file");

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch('/api/extract', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                aadhaarData = data;
                document.getElementById('aadhaarUploadOutput').innerText = JSON.stringify(data, null, 2);
            } catch (err) {
                console.error(err);
                alert("Error uploading Aadhaar file");
            }
        }

        async function saveAadhaar() {
            if (!aadhaarData) return alert("Please upload Aadhaar first");

            try {
                const response = await fetch('/save_aadhaar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(aadhaarData)
                });
                const data = await response.json();
                jwtToken = data.token; // save JWT for PAN saving
                document.getElementById('aadhaarSaveOutput').innerText = JSON.stringify(data, null, 2);
            } catch (err) {
                console.error(err);
                alert("Error saving Aadhaar data");
            }
        }

        // ---------- PAN Functions ----------
        async function uploadPAN() {
            const fileInput = document.getElementById('panFile');
            if (fileInput.files.length === 0) return alert("Please select a file");

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch('/api/extract_pan', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                panData = data;
                document.getElementById('panUploadOutput').innerText = JSON.stringify(data, null, 2);
            } catch (err) {
                console.error(err);
                alert("Error uploading PAN file");
            }
        }

        async function savePAN() {
            if (!panData) return alert("Please upload PAN first");
            if (!jwtToken) return alert("Please save Aadhaar first to get token");

            try {
                const response = await fetch('/save_pan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${jwtToken}`
                    },
                    body: JSON.stringify(panData)
                });
                const data = await response.json();
                document.getElementById('panSaveOutput').innerText = JSON.stringify(data, null, 2);
            } catch (err) {
                console.error(err);
                alert("Error saving PAN data");
            }
        }
    </script>
</body>
</html>
